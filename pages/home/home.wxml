<!--pages/home/home.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<nav-bar 
  searchBar="{{true}}"
  showaw="{{true}}"
  address="{{currentRegion}}"
  weather="{{weatherDisplay}}"
  searchText="æœç´¢å•†å“ã€é’“åœº..."
  background="rgba(255, 255, 255, 0.95)"
  bind:search="onSearch"
  bind:weather="onWeatherTap"
/>

<view class="container">
  <!-- è½®æ’­å›¾ï¼ˆåŒ…å«æ’è¡Œæ¦œï¼‰ -->
  <swiper 
    class="banner-swiper" 
    indicator-dots="{{true}}" 
    autoplay="{{true}}" 
    interval="4000" 
    duration="500" 
    bindchange="onBannerChange"
    circular="{{true}}"
  >
    <swiper-item wx:for="{{bannerList}}" wx:key="id">
      <!-- æ™®é€šè½®æ’­å›¾ -->
      <view class="banner-item" wx:if="{{item.type === 'banner'}}">
        <text class="banner-title">{{item.title}}</text>
      </view>
      
      <!-- æ’è¡Œæ¦œè½®æ’­å›¾ -->
      <view class="ranking-banner" wx:if="{{item.type === 'ranking'}}">
        <view class="ranking-header">
          <text class="ranking-title">ğŸ† {{item.title}}</text>
        </view>
        <view class="ranking-list">
          <view 
            class="ranking-item {{item.rank === 1 ? 'rank-first' : ''}}"
            wx:for="{{item.rankings}}" 
            wx:key="rank"
            wx:for-item="rankItem"
          >
            <view class="rank-number">{{rankItem.rank}}</view>
            <view class="rank-info">
              <text class="rank-name">{{rankItem.name}}</text>
              <text class="rank-spot">{{rankItem.spot}}</text>
            </view>
            <text class="rank-weight">{{rankItem.weight}}</text>
          </view>
        </view>
      </view>
    </swiper-item>
  </swiper>

  <!-- å¤©æ°”ä¿¡æ¯å¡ç‰‡ -->
  <view class="weather-card weather-{{weather.weatherTypeClass}}">
    <!-- åŠ¨æ€èƒŒæ™¯å±‚ -->
    <view class="weather-bg-animation">
      <!-- æ™´å¤©ï¼šå…‰æ™•å’Œç²’å­ -->
      <view class="sun-rays" wx:if="{{weather.weatherTypeClass === 'sunny'}}"></view>
      <view class="particles" wx:if="{{weather.weatherTypeClass === 'sunny'}}">
        <view class="particle" wx:for="{{particles}}" wx:key="index" style="left: {{item.x}}%; top: {{item.y}}%; animation-delay: {{item.delay}}s;"></view>
      </view>
      
      <!-- é›¨å¤©ï¼šé›¨æ»´ -->
      <view class="rain-drops" wx:if="{{weather.weatherTypeClass === 'rainy'}}">
        <view class="rain-drop" wx:for="{{rainDrops}}" wx:key="index" style="left: {{item.x}}%; animation-delay: {{item.delay}}s; animation-duration: {{item.duration}}s;"></view>
      </view>
      
      <!-- å¤šäº‘ï¼šäº‘æœµ -->
      <view class="clouds" wx:if="{{weather.weatherTypeClass === 'cloudy'}}">
        <view class="cloud cloud-1"></view>
        <view class="cloud cloud-2"></view>
        <view class="cloud cloud-3"></view>
      </view>
      
      <!-- é›ªå¤©ï¼šé›ªèŠ± -->
      <view class="snowflakes" wx:if="{{weather.weatherTypeClass === 'snowy'}}">
        <view class="snowflake" wx:for="{{snowflakes}}" wx:key="index" style="left: {{item.x}}%; animation-delay: {{item.delay}}s; animation-duration: {{item.duration}}s;">â„</view>
      </view>
    </view>
    
    <view class="weather-main">
      <view class="weather-left">
        <text class="temperature">{{weather.temperature}}Â°</text>
        <text class="weather-type">{{weather.weatherType}}</text>
      </view>
      <view class="weather-icon-wrapper">
        <text class="weather-icon weather-icon-{{weather.weatherTypeClass}}">{{weather.icon}}</text>
      </view>
    </view>
    <view class="weather-details">
      <view class="weather-item">
        <text class="weather-label">æ°”å‹</text>
        <text class="weather-value">{{weather.hpa}}hPa</text>
      </view>
      <view class="weather-item">
        <text class="weather-label">æ¹¿åº¦</text>
        <text class="weather-value">{{weather.humidity}}%</text>
      </view>
      <view class="weather-item">
        <text class="weather-label">é£é€Ÿ</text>
        <text class="weather-value">{{weather.windSpeed}}m/s</text>
      </view>
      <view class="weather-item">
        <text class="weather-label">é£å‘</text>
        <text class="weather-value">{{weather.windDirection}}</text>
      </view>
      <view class="weather-item">
        <text class="weather-label">èƒ½è§åº¦</text>
        <text class="weather-value">{{weather.visibility}}km</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å…¥å£ -->
  <view class="function-entry">
    <view 
      class="entry-item" 
      wx:for="{{functionList}}" 
      wx:key="id"
      bindtap="onFunctionTap"
      data-function="{{item}}"
    >
      <view class="entry-icon-wrapper entry-bg-{{item.id}}">
        <text class="entry-icon">{{item.icon}}</text>
      </view>
      <text class="entry-text">{{item.name}}</text>
    </view>
  </view>

  <!-- å•†åŸæ¨è -->
  <view class="section shop-section">
    <view class="section-header">
      <text class="section-title">ğŸ›’ çƒ­é—¨å•†å“</text>
      <text class="section-more" bindtap="onMoreTap" data-type="shop">æ›´å¤š ></text>
    </view>
    <swiper 
      class="shop-swiper" 
      autoplay="{{true}}" 
      interval="3000" 
      duration="500"
      circular="{{true}}"
      display-multiple-items="{{2.1}}"
      previous-margin="0"
      next-margin="0"
      bindchange="onShopSwiperChange"
    >
      <swiper-item wx:for="{{shopList}}" wx:key="id">
        <view 
          class="shop-item" 
          bindtap="onShopTap"
          data-shop="{{item}}"
        >
          <view class="shop-image">
            <text class="image-placeholder">ğŸ›ï¸</text>
          </view>
          <text class="shop-name">{{item.name}}</text>
          <text class="shop-price">Â¥{{item.price}}</text>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- ä½å®¿æ¨è -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">ğŸ¨ é™„è¿‘ä½å®¿</text>
      <text class="section-more" bindtap="onMoreTap" data-type="hotel">æ›´å¤š ></text>
    </view>
    <view class="hotel-list">
      <view 
        class="hotel-item" 
        wx:for="{{hotelList}}" 
        wx:key="id"
        bindtap="onHotelTap"
        data-hotel="{{item}}"
      >
        <view class="hotel-image">
          <text class="image-placeholder">ğŸ¨</text>
        </view>
        <view class="hotel-content">
          <view class="hotel-header">
            <text class="hotel-name">{{item.name}}</text>
            <view class="hotel-rating">
              <text class="rating-star">â­</text>
              <text class="rating-value">{{item.rating}}</text>
            </view>
          </view>
          <text class="hotel-distance">ğŸ“ è·ç¦»ï¼š{{item.distance}}</text>
          <text class="hotel-address">{{item.address}}</text>
          <view class="hotel-footer">
            <text class="hotel-price">Â¥{{item.price}}/æ™š</text>
            <view class="hotel-tags">
              <text class="hotel-tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¼˜è´¨é’“åœºæ¨è -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">â­ ä¼˜è´¨é’“åœºæ¨è</text>
      <text class="section-more" bindtap="onMoreTap" data-type="spot">æ›´å¤š ></text>
    </view>
    
    <view class="spots-list">
      <view 
        class="spot-item" 
        wx:for="{{recommendedSpots}}" 
        wx:key="id"
        bindtap="onSpotTap"
        data-spot="{{item}}"
      >
        <view class="spot-image">
          <text class="image-placeholder">ğŸ£</text>
        </view>
        <view class="spot-content">
          <view class="spot-header">
            <text class="spot-name">{{item.name}}</text>
            <view class="spot-rating">
              <text class="rating-star">â­</text>
              <text class="rating-value">{{item.rating}}</text>
            </view>
          </view>
          <text class="spot-distance">ğŸ“ è·ç¦»ï¼š{{item.distance}}</text>
          <text class="spot-address">{{item.address}}</text>
          
          <!-- æ ‡ç­¾ -->
          <view class="spot-tags">
            <view class="tag-item" wx:if="{{item.tags.indexOf('wifi') !== -1}}">
              <text class="tag-icon">ğŸ“¶</text>
              <text class="tag-text">WiFi</text>
            </view>
            <view class="tag-item" wx:if="{{item.tags.indexOf('parking') !== -1}}">
              <text class="tag-icon">ğŸ…¿ï¸</text>
              <text class="tag-text">åœè½¦åœº</text>
            </view>
            <view class="tag-item" wx:if="{{item.tags.indexOf('toilet') !== -1}}">
              <text class="tag-icon">ğŸš»</text>
              <text class="tag-text">å«ç”Ÿé—´</text>
            </view>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="spot-actions">
            <view class="action-btn phone-btn" bindtap="onCallPhone" data-phone="{{item.phone}}" catchtap="true">
              <image class="btn-icon-img" src="/images/icons/phone.png" mode="aspectFit" wx:if="{{iconPhone}}"></image>
              <text class="btn-icon" wx:else>ğŸ“</text>
              <text class="btn-text">ç”µè¯</text>
            </view>
            <view class="action-btn navigate-btn" bindtap="onNavigate" data-spot="{{item}}" catchtap="true">
              <text class="btn-icon">ğŸ§­</text>
              <text class="btn-text">å¯¼èˆª</text>
            </view>
            <text class="spot-price">{{item.price}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åœ°åŒºé€‰æ‹©å™¨ -->
  <view class="region-picker-mask" wx:if="{{showRegionPicker}}" bindtap="onRegionPickerClose">
    <view class="region-picker" catchtap="true">
      <view class="picker-header">
        <text class="picker-title">é€‰æ‹©åœ°åŒº</text>
        <text class="picker-close" bindtap="onRegionPickerClose">âœ•</text>
      </view>
      <view class="picker-content">
        <view 
          class="picker-item" 
          wx:for="{{regionList}}" 
          wx:key="*this"
          bindtap="onRegionSelect"
          data-region="{{item}}"
        >
          <text class="picker-item-text {{currentRegion === item ? 'selected' : ''}}">{{item}}</text>
          <text class="picker-check" wx:if="{{currentRegion === item}}">âœ“</text>
        </view>
      </view>
    </view>
  </view>
</view>
